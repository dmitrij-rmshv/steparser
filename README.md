# STEPARSER

## Парсер текстовых таблиц для заполнения в Postgres

Прохожу замечательнейший онлайн-курс [Интерактивный тренажер по SQL](https://stepik.org/course/63054/syllabus) на известной образовательной платформе.
Тренажер этот построен на MySQL версии 8.0.21. Но целью моей сейчас является освоение Postgres. Потому параллельно прохождению курса отрабатываю все задания именно на этой платформе, для чего развернул дома сервер. И, дабы облегчить формирование тренажерных таблиц, написал на Python3 этот скрипт.

### использование

Выделить в браузере таблицу, и сохранить выделение в пустой файл, который сохранить рядом с файлом скрипта, запустить файл на исполнение

    python3 [-c] input_file_name
опция `-c` предварительно создаёт (CREATE) таблицу, без неё происходит только заполнение предварительно созданной таблицы, разъяснения далее.

### какие входные данные допустимы

Изначально скрипт поддерживал только таблицы - результаты SELECT-а из MySQL - то есть облачённые в плюсы-минусы:

    Query result:
    +---------+-----------------------+------------------+--------+--------+
    | book_id | title                 | author           | price  | amount |
    +---------+-----------------------+------------------+--------+--------+
    | 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
    | 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
    | 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
    | 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
    | 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |
    +---------+-----------------------+------------------+--------+--------+
    Affected rows: 5
**ОБЯЗАТЕЛЬНО:** первый столбец должен быть *идентификатором*, из него считывается название заполняемой таблицы (из предположения, что его "правильно" назвали, а другого я по курсу пока не обнаружил)
**также**, к такой таблице неприменима опция `-c`  

***Далее*** я развил скрипт поддержкой разбора таблиц, представленных в заданиях в виде обычных HTML-таблиц. Порядок действий с ними аналогичный - скопировать (первая строка при этом должна содержать заголовки полей), вставить в файл, запустить скрипт с указанием имени файла.
Здесь возникает возможность использования опции `-c` - в том случае, если второй строкой, после заголовков полей идёт строка их описания. Применяя эту функцию, надо помнить, что описания полей не всегда *полностью* описывает таблицу - там могут быть ещё `FOREIGN KEY`, или ещё что-нибудь, что не найдёт отражения в результирующей таблице. В этом случае надо предварительно вручную создать таблицу, и после этого заполнить её скриптом без опции `-c`, 
**либо** создавать с опцией `-c`, но после этого модифицировать (`ALTER TABLE`)
**ОБЯЗАТЕЛЬНО:** HTML - таблица, в ячейках которой есть переносы на другую строку, например

    INT PRIMARY KEY
    AUTO_INCREMENT
или

    Превышение скорости
    (от 40 до 60)
*НЕ переваривается* данным скриптом. Для осуществления этого требуется более сложный подход, который я пока не нахожу "рентабельным" для реализации 

### зависимости
наличие интерпретатора Python3
а также внешней библиотеки для работы с Postgres: `psycopg2-binary==2.9.3`
установка:

    pip install requirements.txt

### настройка
для взаимодействия скрипта с БД Postgres разумеется требуется натройка параметров

    con = psycopg2.connect(
      database="db_name", 
      user="your_username", 
      password="your_password", 
      host="192.168.1.23", 
      port="5432"
    )
в строках 45-51 открывается соединение с БД, в параметры которого необходимо перезаписать своими данными

сентябрь 2022
